<html>
<head>
    <script>
        window.onload = function () {
            var brewData = [];
            var steamData = [];
            var data = {
                datasets: [{
                    label: 'Temperature',
                    data: [],
                }, {
                    label: 'Output',
                    data: brewData,
                }],
            };

            const options = {
                interaction: {
                    mode: 'nearest',
                    axis: 'x',
                    intersect: false
                },
                plugins: {
                    decimation: {
                        enabled: 'true',
                        algorithm: 'lttb',
                        samples: 50
                    }
                },
                scales: {
                    x: {
                        type: 'timeseries',
                        time: {
                            unit: 'second',
                            stepSize: 25,
                        },
                        ticks: {
                            source: 'data',
                            autoSkip: true,
                            maxRotation: 10,
                        },
                    },
                    y: {
                        min: 0
                    },
                },
            }

            const actions = [{
                name: "Display Brew Temps",
                handler() {
                    chart.update();
                },
            }, {
                name: "Display Steam Temps",
                handler() {
                    chart.update();
                }
            }];

            const ctx = document.getElementById('tempChart').getContext('2d');
            var chart = new Chart(ctx, {
                type: 'line',
                data: data,
                options: options,
            });

            const container = document.getElementById('tempContainer');
            actions.forEach(function(action){
                const button = document.createElement('button');
                button.innerHTML = action.name;
                button.onclick = action.handler;
                container.appendChild(button);
            });

            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function(){
                if (this.readyState == 4 && this.status == 200) {
                    var tempData = JSON.parse(this.response);
                    chart.data.datasets[0].data.push({x: Date.now(), y: tempData.temperature});
                    brewData.push(tempData.brew);
                    steamData.push(tempData.steam);
                    chart.update();
                    pollServer(this);
                }
            }
            function pollServer(xhttp) {
                console.log(xhttp);
                xhttp.open("GET", "/get_temps", true);
                xhttp.send();
                console.log('hello');
            }
            pollServer(xhttp);
        }
    </script>
</head>
<body>
    <div id="tempContainer" class="chart-container" style="position:relative; height:40vh; width:120vh; margin:auto;">
        <canvas id="tempChart"></canvas>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.3.2"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment@0.1.1"></script>
</body>
</html>